<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2002-2003 by Lutz Sammer

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; only version 2 of the License.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Stratagus Configuration Language Description: Content</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
    <meta name="Author" content="johns98@gmx.net">
    <meta name="Author" content="cleonard@go.ro">
    <meta name="Keyword" content="scripting">
    <meta name="Description" content="Scripting languag main structure">
</head>
<body>
    <h1>Stratagus Configuration Language Description: Content</h1>
<hr><pre width=80>
         _________ __                 __                               
        /   _____//  |_____________ _/  |______     ____  __ __  ______
        \_____  \\   __\_  __ \__  \\   __\__  \   / ___\|  |  \/  ___/
        /        \|  |  |  | \// __ \|  |  / __ \_/ /_/  >  |  /\___ \ 
       /_______  /|__|  |__|  (____  /__| (____  /\___  /|____//____  >
               \/                  \/          \//_____/            \/ 
    ______________________                           ______________________
			  T H E   W A R   B E G I N S
	   Stratagus - A free fantasy real time strategy game engine
</pre>
<p><b>(C) Copyright 1998-2003 by The Stratagus Project. Distributed under the
<a href="../gpl.html">"GNU General Public License"</a></b>
<hr>
<a href="../stratagus.html">Stratagus</a> 
<a href="../readme.html">Readme</a> 
<a href="../faq.html">FAQ</a> 
<a href="ccl.html">CCL</a> 
<a href="ccl-index.html">Index</a> 
<hr>
<h2>Intro - Introduction to CCL - Craft Configuration Language</h2>

<p>Stratagus is a real-time strategy engine. To define
the different games a configuration language is needed.</p>
<p>The old scripting language was used mostly in a declarative way,
with functions for everything. I am changing that, in the branch
called META_LUA (you just change an ifdef in stratagus.h to get it)</p>

<h3>Scripting interface design</h3>
<p>All the scripting interface will be in one big lua table, called
<b>Stratagus</b>. If you think that's too long something like Game could do.
Inside that table, most configurable structures in the game will be
accessbile. For instance Stratagus.UnitTypes[3] or Stratagus.UnitTypes["unit_goldmine"]
will get you a reference to a UnitType, with an meta-table written in C,
that overrides __index and __new_index (meaning get and set).</p>
<p>The main <b>Stratagus</b> table will be accessible at all times.
However, having a lua table for each and every struct we use would be
a huge resource waste. This is why we make a table only when we want to get it
the actual struct. It works by returning userdate, not a table. userdata is
a special type in lua, and it's mostly opaque to lua, it's good to store random
C values. In userdata, the metatable also has an __gc function, that gets called
by the lua garbage collector.</p>
<p>All lua accessible struct get a LuaTable field, initially 0, that gets set first time
we get the table. If lua wants it again, we just return the same thing. When __gc
gets called it sets the field back to 0. Most of this is done with macros, to keep
the code simple to understand.</p>

<h2>Content</h2>

<a href="ai.html">Artificial Intelligence (AI)</a> <br>
<a href="config.html">Config</a> <br>
<a href="game.html">Game</a> <br>
<a href="icon.html">Icon</a> <br>
<a href="magic.html">Magic</a> <br>
<a href="pud.html">Pud format support</a> <br>
<a href="research.html">Research and Upgrades</a> <br>
<a href="sound.html">Sound</a> <br>
<a href="tileset.html">Tileset</a> <br>
<a href="triggers.html">Triggers</a> <br>
<a href="ui.html">User Interface (UI)</a> <br>
<a href="unittype.html">UnitType</a> <br>
<p>
<a href="ccl-index.html">Index</a> of all the ccl functions.

<hr>
Last changed: $Id$<br>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2003 by <a href="http://stratagus.org">
The Stratagus Project</a></address></body></html>
