<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2002-2003 by Lutz Sammer

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; only version 2 of the License.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Stratagus Configuration Language Description: Triggers</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
    <meta name="Author" content="johns98@gmx.net">
    <meta name="Keyword" content="ccl,tileset">
    <meta name="Description" content="">
</head>
<body>
    <h1>Stratagus Configuration Language Description: Triggers</h1>
<hr><pre width=80>
         _________ __                 __                               
        /   _____//  |_____________ _/  |______     ____  __ __  ______
        \_____  \\   __\_  __ \__  \\   __\__  \   / ___\|  |  \/  ___/
        /        \|  |  |  | \// __ \|  |  / __ \_/ /_/  >  |  /\___ \ 
       /_______  /|__|  |__|  (____  /__| (____  /\___  /|____//____  >
               \/                  \/          \//_____/            \/ 
    ______________________                           ______________________
			  T H E   W A R   B E G I N S
	   Stratagus - A free fantasy real time strategy game engine
</pre>
<p><b>(C) Copyright 2002-2003 by The Stratagus Project. Distributed under the
<a href="../gpl.html">"GNU General Public License"</a></b>
<hr>
<a href="../stratagus.html">Stratagus</a> 
<a href="../readme.html">Readme</a> 
<a href="../faq.html">FAQ</a> 
<a href="ccl.html">CCL</a> 
<a href="tileset.html">PREV</a> 
<a href="ui.html">NEXT</a> 
<a href="ccl-index.html">Index</a> 
<hr>
<a href="#action-defeat">action-defeat</a>
<a href="#action-draw">action-draw</a>
<a href="#action-set-switch">action-set-switch</a>
<a href="#action-set-timer">action-set-timer</a>
<a href="#action-start-timer">action-start-timer</a>
<a href="#action-stop-timer">action-stop-timer</a>
<a href="#action-victory">action-victory</a>
<a href="#action-wait">action-wait</a>
<a href="#add-trigger">add-trigger</a>
<a href="#if-elapsed">if-elapsed</a>
<a href="#if-kills">if-kills</a>
<a href="#if-near-unit">if-near-unit</a>
<a href="#if-opponents">if-opponents</a>
<a href="#if-rescued-near-unit">if-rescued-near-unit</a>
<a href="#if-resource">if-resource</a>
<a href="#if-score">if-score</a>
<a href="#if-switch">if-switch</a>
<a href="#if-timer">if-timer</a>
<a href="#if-unit">if-unit</a>
<a href="#if-unit-at">if-unit-at</a>
<a href="#set-trigger-number!">set-trigger-number!</a>
<hr>
<h2>Intro - Introduction to trigger functions and variables</h2>

Everything around triggers.
<h2>Functions</h2>

<a name="action-defeat"></a>
<h3>(action-defeat)</h3>

The condition player is set to defeat.


<h4>Example</h4>

<pre>
    ;; Adds a trigger.  If the player on the console has 0 units then he loses.
    (add-trigger
      '(
        (if-unit 'this '== 0 'all))
      '(
        (action-defeat)))
</pre>

<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="action-draw"></a>
<h3>(action-draw)</h3>

The condition player is set to draw. (NOT SUPPORTED)


<h4>Example</h4>

<pre>
    (action-draw)
</pre>
<h4>Not Used</h4>

<a name="action-set-switch"></a>
<h3>(action-set-switch number set)</h3>

Set a switch.


<dl>
<dt>number</dt>
<dd>The switch number.
</dd>
<dt>set</dt>
<dd>#t to set the switch on, #f to clear or turn the switch off
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Sets switch 1 on.
    (action-set-switch 1 #t)
</pre>

<h4>Not Used</h4>

<a name="action-set-timer"></a>
<h3>(action-set-timer cycles increasing)</h3>

Set the timer.


<dl>
<dt>cycles</dt>
<dd>The number of cycles (default setting is 30 cycles per second).
</dd>
<dt>increasing</dt>
<dd>Set this to 1 if you want the timer to increase, set it to 0 for decreasing.
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Sets the timer to 9000 cycles (300 seconds or 5 minutes) and decreasing.
    (action-set-timer 9000 0)
</pre>

<h4>Not Used</h4>

<a name="action-start-timer"></a>
<h3>(action-start-timer)</h3>

Start the timer.


<h4>Example</h4>

<pre>
    ;; Starts the timer.
    (action-start-timer)
</pre>

<h4>Not Used</h4>

<a name="action-stop-timer"></a>
<h3>(action-stop-timer)</h3>

Stop the timer.


<h4>Example</h4>

<pre>
    ;; Stops the timer.
    (action-stop-timer)
</pre>

<h4>Not Used</h4>

<a name="action-victory"></a>
<h3>(action-victory)</h3>

The condition player is set to victory.


<h4>Example</h4>

<pre>
    ;; Adds a trigger. If the player on the console has killed all his 
    ;; opponents he won.
    (add-trigger
      '(
        (if-opponents 'this '== 0))
      '(
        (action-victory)))
</pre>

<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="action-wait"></a>
<h3>(action-wait ms)</h3>

Causes the trigger to wait a minimum number of milliseconds.


<dl>
<dt>ms</dt>
<dd>Minimum number of milliseconds to wait.
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Adds a trigger. If the player on the console has killed all his 
    ;; opponents the message "Hello" appears then two seconds later the message
    ;; "World" appears.
    (add-trigger
      '(
        (if-opponents 'this '== 0))
      '(
        (add-message "Hello")
        (action-wait 2000)
        (add-message "World")
        #f))
</pre>

<h4>Not Used</h4>

<a name="add-trigger"></a>
<h3>(add-trigger condition action)</h3>

Creates a new trigger.


<dl>
<dt>condition</dt>
<dd><pre>
condition can be
	'(
          (or
            (and condition1 conditon2 ...)
	    (and condition3 condition4 ...)))
	...
	- condition1 and condition2 and ... must be true or condition3
	  and condition4 and ... must be true to execute the action.
</pre></dd>
<dt>action</dt>
<dd><pre>
action can be any valid scheme (CCL) statement and is executed if
the condition is true.  The trigger remains active if the action
returns true and is removed if the action returns false.
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Adds a trigger. If the player on the console has killed all his 
    ;; opponents he won.
    (add-trigger
      '(
        (if-opponents 'this '== 0))
      '(
        (action-victory)))
</pre>

<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="if-elapsed"></a>
<h3>(if-elapsed op quantity)</h3>

Game run for duration.  If the game run for the duration game cycles the action is executed.


<dl>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the game has run for 300 cycles.
    (if-elapsed '&gt;= 300)
</pre>

<h4>Not Used</h4>

<a name="if-kills"></a>
<h3>(if-kills player op quantity)</h3>

Player has quantity of kills. Which quantity must be killed by the
player for the action.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    (if-kills 'this '&gt;= 30)
</pre>
<h4>Not Used</h4>

<a name="if-near-unit"></a>
<h3>(if-near-unit player op quantity unit unit)</h3>

Player has the quantity of unit-type near to unit-type. Which unit 
and how many units must the player have near to an other unit for 
the action.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
<dt>unit</dt>
<dd><pre>
'unit-name  Unit type of this name
'any        Matches any unit type
'all        All units (sum of units and buildings)
'units      All non building units
'building   All building units
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the player on the console has 6 archers near the circle of power.
    (if-near-unit 'this '== 6 'unit-archer 'unit-circle-of-power)
</pre>

<h4>Not Used</h4>

<a name="if-opponents"></a>
<h3>(if-opponents player op quantity)</h3>

Player has the quantity of opponents.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    (if-opponents 'this '== 0)
</pre>
<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="if-rescued-near-unit"></a>
<h3>(if-rescued-near-unit player op quantity unit unit)</h3>

Player has the quantity of rescued unit-type near to unit-type. Which 
rescued unit and how many units must the player have near to a unit 
for the action.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
<dt>unit</dt>
<dd><pre>
'unit-name  Unit type of this name
'any        Matches any unit type
'all        All units (sum of units and buildings)
'units      All non building units
'building   All building units
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; The player on the console has 1 rescued archer near the circle of power.
    (if-rescued-near-unit 'this '== 1 'unit-archer 'unit-circle-of-power)
</pre>

<h4>Not Used</h4>

<a name="if-resource"></a>
<h3>(if-resource player op quantity resource)</h3>

Player has the quantity of resources. This condition is used to 
specify how many or how little resources (gold, oil, lumber) a 
player must have for the action.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
<dt>resource</dt>
<dd><pre>
Name of the resource or:
'all        Sum of all resources in store
'any        Any resource
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the player on the console has at least 5000 gold.
    (if-resource 'this '&gt;= 5000 'gold)
</pre>

<h4>Not Used</h4>

<a name="if-score"></a>
<h3>(if-score player op quantity)</h3>

Player has the quantity of score. If the player reaches the 
quantity of score the action is executed.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the player on the console has a score of at least 1000.
    (if-score 'this '&gt;= 1000)
</pre>

<h4>Not Used</h4>

<a name="if-switch"></a>
<h3>(if-switch number set)</h3>

Checks the value of a switch.


<dl>
<dt>number</dt>
<dd>Number of the switch
</dd>
<dt>set</dt>
<dd>#t to check if the switch is on, #f for off
</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Checks if switch 1 is on.
    (if-switch 1 #t)
</pre>

<h4>Not Used</h4>

<a name="if-timer"></a>
<h3>(if-timer op cycles)</h3>

Timer reaches quantity. If the timer reaches quantity the action is executed.


<dl>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>cycles</dt>
<dd><pre>
0 ... oo    Number of cycles
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the timer is at 0 cycles.
    (if-timer '== 0)
</pre>

<h4>Not Used</h4>

<a name="if-unit"></a>
<h3>(if-unit player op quantity unit)</h3>

Player has the quantity of unit-type. Which unit and how many 
units must control the player for the action.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
<dt>unit</dt>
<dd><pre>
'unit-name  Unit type of this name
'any        Matches any unit type
'all        All units (sum of units and buildings)
'units      All non building units
'building   All building units
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the player on the console has at least 8 archers.
    (if-unit 'this '&gt;= 8 'unit-archer)
</pre>

<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="if-unit-at"></a>
<h3>(if-unit-at player op quantity unit location1 location2)</h3>

Player has the quantity of unit-type at a location.


<dl>
<dt>player</dt>
<dd><pre>
0 .. 16    Player number
'any       Matches any player
'all       All players (Not used)
'this      Player on the local computer, Human player in the campaign.
</pre></dd>
<dt>op</dt>
<dd><pre>
'==         operator equal
'&gt;          operator greater than
'&gt;=         operator greater than or equal
'&lt;          operator less than
'&lt;=         operator less than or equal
</pre></dd>
<dt>quantity</dt>
<dd><pre>
0 ... oo    Number for the quantity
</pre></dd>
<dt>unit</dt>
<dd><pre>
'unit-name  Unit type of this name
'any        Matches any unit type
'all        All units (sum of units and buildings)
'units      All non building units
'building   All building units
</pre></dd>
<dt>location1</dt>
<dd><pre>
'(x1 y1)   Upper left corner
</pre></dd>
<dt>location2</dt>
<dd><pre>
'(x2 y2)   Lower right corner
</pre></dd>
</dl>

<h4>Example</h4>

<pre>
    ;; If the player on the console has at least 8 archers in the rectangle
    ;; (10 10) to (12 14).
    (if-unit-at 'this '&gt;= 8 'unit-archer '(10 10) '(12 14))
</pre>

<h4>Used</h4>

<a href="../../data/ccl/stratagus.ccl"> $LIBARYPATH/ccl/stratagus.ccl </a>

<a name="set-trigger-number!"></a>
<h3>(set-trigger-number! number)</h3>

Set the current trigger number.


<dl>
<dt>number</dt>
<dd>Trigger number (0 offset, -1 for no current trigger)</dd>
</dl>

<h4>Example</h4>

<pre>
    ;; Set the current trigger to the first trigger.
    (set-trigger-number! 0)
</pre>

<h4>Not Used</h4>

<hr>
Last changed: $Id$<br>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2003 by <a href="http://stratagus.org">
The Stratagus Project</a></address></body></html>
